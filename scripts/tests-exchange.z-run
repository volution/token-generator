#!/dev/null








<< tests / quick / exchange / debug
	"${ZRUN}" ':: cargo / debug / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--debug--linux--native" "${@}" \
	#
!!


<< tests / quick / exchange / release
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" "${@}" \
	#
!!








<< tests / quick / exchange / armor / hello
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			armor \
		<<< $'hello world!\n' \
	#
!!


<< tests / quick / exchange / armor / empty
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			armor \
		<<< '' \
	#
!!


<< tests / quick / exchange / armor / notice
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			armor \
		< ./notice.txt \
	#
!!




<< tests / quick / exchange / armor & dearmor / hello
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			armor \
		<<< $'hello world!\n' \
	| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			dearmor \
	#
!!




<< tests / quick / exchange / armor & dearmor / files
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	readarray -t -- _files \
		< <( exec -- "${ZRUN}" ':: tests / quick / exchange / files' ) -
	#
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	for _file in "${_files[@]}" ; do
		
		"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				armor \
			< "${_file}" \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				dearmor \
		| md5sum -b -- /dev/fd/5 5<&0 \
		| md5sum -c --quiet 5< "${_file}" \
		#
		
	done
!!




<< tests / quick / exchange / armor & dearmor / random
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	for _index_1 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
	for _index_2 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
	for _index_3 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
		
		printf -- '[ii]  running iteration `%02d-%02d-%02d`...\n' "${_index_1}" "${_index_2}" "${_index_3}" >&2
		
		for _try in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
		
		while true ; do
			_size="${SRANDOM}"
			if test "${_size}" -le 134217728 ; then break ; fi
		done
		
		TIMEFORMAT="[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;  ${_size} bytes;"
		
		time \
		head -c "${_size}" < /dev/urandom \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				armor \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				dearmor \
			> /dev/null \
		#
		
	done ; done ; done ; done
!!








<< tests / quick / exchange / keys
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			keys "${@}" \
	#
!!


<< tests / quick / exchange / keys / self
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			keys --self true "${@}" \
	#
!!




<< tests / quick / exchange / ssh / keys
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			ssh keys "${@}" \
	#
!!


<< tests / quick / exchange / ssh / wrap / hello
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:?}"
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			ssh wrap "${@}" \
				--key "${_ssh_wrap}" \
		<<< $'hello world!\n' \
	#
!!




<< tests / quick / exchange / encrypt / hello
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	_sender_private="${__ZTOKENS_EXCHANGE_SENDER_PRIVATE:?}"
	_recipient_public="${__ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC:-}"
	
	_secret="${__ZTOKENS_EXCHANGE_SECRET:-}"
	_pin="${__ZTOKENS_EXCHANGE_PIN:-}"
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:-}"
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			encrypt \
				--sender "${_sender_private}" \
				--recipient "${_recipient_public}" \
				--secret "${_secret}" \
				--pin "${_pin}" \
				--ssh-wrap "${_ssh_wrap}" \
				--siv \
				--empty-is-missing true \
		<<< $'hello world!\n' \
	#
!!


<< tests / quick / exchange / encrypt / empty
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	_sender_private="${__ZTOKENS_EXCHANGE_SENDER_PRIVATE:?}"
	_recipient_public="${__ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC:-}"
	
	_secret="${__ZTOKENS_EXCHANGE_SECRET:-}"
	_pin="${__ZTOKENS_EXCHANGE_PIN:-}"
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:-}"
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			encrypt \
				--sender "${_sender_private}" \
				--recipient "${_recipient_public}" \
				--secret "${_secret}" \
				--pin "${_pin}" \
				--ssh-wrap "${_ssh_wrap}" \
				--siv \
				--empty-is-missing true \
		<<< '' \
	#
!!


<< tests / quick / exchange / encrypt / notice
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	_sender_private="${__ZTOKENS_EXCHANGE_SENDER_PRIVATE:?}"
	_recipient_public="${__ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC:-}"
	
	_secret="${__ZTOKENS_EXCHANGE_SECRET:-}"
	_pin="${__ZTOKENS_EXCHANGE_PIN:-}"
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:-}"
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			encrypt \
				--sender "${_sender_private}" \
				--recipient "${_recipient_public}" \
				--secret "${_secret}" \
				--pin "${_pin}" \
				--ssh-wrap "${_ssh_wrap}" \
				--siv \
				--empty-is-missing true \
		< ./notice.txt \
	#
!!




<< tests / quick / exchange / encrypt & decrypt / hello
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
	
	_sender_private="${__ZTOKENS_EXCHANGE_SENDER_PRIVATE:?}"
	_sender_public="${__ZTOKENS_EXCHANGE_SENDER_PUBLIC:-}"
	
	_recipient_private="${__ZTOKENS_EXCHANGE_RECIPIENT_PRIVATE:-}"
	_recipient_public="${__ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC:-}"
	
	_secret="${__ZTOKENS_EXCHANGE_SECRET:-}"
	_pin="${__ZTOKENS_EXCHANGE_PIN:-}"
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:-}"
	
	time \
	"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			encrypt \
				--sender "${_sender_private}" \
				--recipient "${_recipient_public}" \
				--secret "${_secret}" \
				--pin "${_pin}" \
				--ssh-wrap "${_ssh_wrap}" \
				--empty-is-missing true \
		<<< $'hello world!\n' \
	| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
			decrypt \
				--sender "${_sender_public}" \
				--recipient "${_recipient_private}" \
				--secret "${_secret}" \
				--pin "${_pin}" \
				--ssh-wrap "${_ssh_wrap}" \
				--empty-is-missing true \
	#
!!




<< tests / quick / exchange / encrypt & decrypt / files
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	_sender_private="${__ZTOKENS_EXCHANGE_SENDER_PRIVATE:?}"
	_sender_public="${__ZTOKENS_EXCHANGE_SENDER_PUBLIC:-}"
	
	_recipient_private="${__ZTOKENS_EXCHANGE_RECIPIENT_PRIVATE:-}"
	_recipient_public="${__ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC:-}"
	
	_secret="${__ZTOKENS_EXCHANGE_SECRET:-}"
	_pin="${__ZTOKENS_EXCHANGE_PIN:-}"
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:-}"
	
	readarray -t -- _files \
		< <( exec -- "${ZRUN}" ':: tests / quick / exchange / files' ) -
	#
	
	for _index_1 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
	for _index_2 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
	for _index_3 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
		
		printf -- '[ii]  running iteration `%02d-%02d-%02d`...\n' "${_index_1}" "${_index_2}" "${_index_3}" >&2
		
		TIMEFORMAT='[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;'
		
		time \
		for _file in "${_files[@]}" ; do
		
		"${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				encrypt \
					--sender "${_sender_private}" \
					--recipient "${_recipient_public}" \
					--secret "${_secret}" \
					--pin "${_pin}" \
					--ssh-wrap "${_ssh_wrap}" \
					--empty-is-missing true \
			< "${_file}" \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				decrypt \
					--sender "${_sender_public}" \
					--recipient "${_recipient_private}" \
					--secret "${_secret}" \
					--pin "${_pin}" \
					--ssh-wrap "${_ssh_wrap}" \
					--empty-is-missing true \
		| md5sum -b -- /dev/fd/5 5<&0 \
		| md5sum -c --quiet 5< "${_file}" \
		#
		
	done ; done ; done ; done
!!




<< tests / quick / exchange / encrypt & decrypt / random
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	_sender_private="${__ZTOKENS_EXCHANGE_SENDER_PRIVATE:?}"
	_sender_public="${__ZTOKENS_EXCHANGE_SENDER_PUBLIC:-}"
	
	_recipient_private="${__ZTOKENS_EXCHANGE_RECIPIENT_PRIVATE:-}"
	_recipient_public="${__ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC:-}"
	
	_secret="${__ZTOKENS_EXCHANGE_SECRET:-}"
	_pin="${__ZTOKENS_EXCHANGE_PIN:-}"
	
	_ssh_wrap="${__ZTOKENS_EXCHANGE_SSH_WRAP:-}"
	
	for _index_1 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
	for _index_2 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
	for _index_3 in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
		
		printf -- '[ii]  running iteration `%02d-%02d-%02d`...\n' "${_index_1}" "${_index_2}" "${_index_3}" >&2
		
		for _try in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ; do
		
		while true ; do
			_size="${SRANDOM}"
			if test "${_size}" -le 134217728 ; then break ; fi
		done
		
		TIMEFORMAT="[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;  ${_size} bytes;"
		
		time \
		head -c "${_size}" < /dev/urandom \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				encrypt \
					--sender "${_sender_private}" \
					--recipient "${_recipient_public}" \
					--secret "${_secret}" \
					--pin "${_pin}" \
					--ssh-wrap "${_ssh_wrap}" \
					--empty-is-missing true \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" \
				decrypt \
					--sender "${_sender_public}" \
					--recipient "${_recipient_private}" \
					--secret "${_secret}" \
					--pin "${_pin}" \
					--ssh-wrap "${_ssh_wrap}" \
					--empty-is-missing true \
			> /dev/null \
		#
		
	done ; done ; done ; done
!!








<< tests / quick / exchange / encrypt & decrypt / cases
	test "${#}" -eq 0
	"${ZRUN}" ':: cargo / release / build & collect' z-exchange < /dev/null > /dev/null
	export -- RUST_BACKTRACE=1
	
	for _case_deterministic in with-siv without-salt ; do
	for _case_secret in without-secret empty-secret with-secret-1 with-secret-1d with-secret-2 with-secret-2d ; do
	for _case_ssh_wrap in without-ssh-wrap empty-ssh-wrap with-ssh-wrap-1 with-ssh-wrap-1d with-ssh-wrap-2 with-ssh-wrap-2d ; do
	for _case_pin in without-pin empty-pin with-pin-1 with-pin-1d with-pin-2 with-pin-2d ; do
	for _case_send in without-x25519 empty-x25519 send-x25519 self-x25519 ; do
		
		_pin_1="${SRANDOM}"
		_pin_2="${SRANDOM}"
		
		_secret_1=ztxcs1qvjhy8ftc7fjajtky3mcrgxdlacer2m6sj8hyxcaa2segdcnhjnqj7ylhm
		_secret_2=ztxcs1zw32errd0vu44rvt2h6vnmfecjtp20aacyzpxcyg9dq3szerw0sswvu32a
		
		_ssh_wrap_1=ztxws1qqqqqzmnwd5z6etyxg6n2vfeqqqqqg9e9nt4vgd7c6s4tgmecj86kwpfpj7nsnnujzq6f4243jl2vecyrsqspf9hel
		_ssh_wrap_2=ztxws1qqqqqzmnwd5z6etyxg6n2vfeqqqqqgyg7zfdlhxsaymch3pu5c74xz82y5pt67grpy6ej8tcatltw4ar0gqss7rhum
		
		_file=./notice.txt
		
		_encrypt_arguments=()
		_decrypt_arguments=()
		_common_arguments=()
		
		printf -- '\n' >&2
		printf -- '[ii]  running iteration `%s %s %s %s %s`...\n' "${_case_send}" "${_case_pin}" "${_case_secret}" "${_case_ssh_wrap}" "${_case_deterministic}" >&2
		
		_empty_is_missing=false
		
		case "${_case_send}" in
			( send-x25519 )
				_encrypt_arguments+=(
						--sender ztxsk1szluhkftlf5zee8wfd6v43el6qa9c7f74sn3xaxjrxzh84q7436qhmh920
						--recipient ztxrp17qqdhxkytsfp0ugz0h3zxuy4l2hhszxpaqt9cmqndjg8qllxfamszurtah
					)
				_decrypt_arguments+=(
						--recipient ztxrk1rp0qkrrrht77nh42pkzcf70uy3yrs5uxpq6uvql55h3jsgsxm9fqn6lxmk
						--sender ztxsp1m6f9fwz0ukd7agd3udrlqsu8j0ltc8evfpzw7n040yjatkr4u4nq38he88
					)
			;;
			( self-x25519 )
				_encrypt_arguments+=(
						--sender ztxsk17zpadjtunyk3tst6p08e8qk9hpaxvrat595vy3kgtu0t8d8ehazqg5na4m
					)
				_decrypt_arguments+=(
						--recipient ztxrk17zpadjtunyk3tst6p08e8qk9hpaxvrat595vy3kgtu0t8d8ehazqfgdyps
					)
			;;
			( without-x25519 )
			;;
			( empty-x25519 )
				_encrypt_arguments+=(
						--sender ''
					)
				_decrypt_arguments+=(
					)
				_empty_is_missing=true
			;;
			( __* )
				continue
			;;
			( * )
				false
			;;
		esac
		
		case "${_case_pin}" in
			( with-pin-1 )
				_common_arguments+=(
						--pin "${_pin_1}"
					)
			;;
			( with-pin-1d )
				_encrypt_arguments+=(
						--pin "${_pin_1}"
					)
				_decrypt_arguments+=(
						--pin "${_pin_1}"
						--pin "${_pin_1}"
					)
			;;
			( with-pin-2 )
				_encrypt_arguments+=(
						--pin "${_pin_1}"
						--pin "${_pin_2}"
					)
				_decrypt_arguments+=(
						--pin "${_pin_2}"
						--pin "${_pin_1}"
					)
			;;
			( with-pin-2d )
				_encrypt_arguments+=(
						--pin "${_pin_1}"
						--pin "${_pin_1}"
						--pin "${_pin_2}"
					)
				_decrypt_arguments+=(
						--pin "${_pin_2}"
						--pin "${_pin_1}"
						--pin "${_pin_1}"
					)
			;;
			( without-pin )
			;;
			( empty-pin )
				_encrypt_arguments+=(
						--pin ''
					)
				_decrypt_arguments+=(
					)
				_empty_is_missing=true
			;;
			( __* )
				continue
			;;
			( * )
				false
			;;
		esac
		
		case "${_case_secret}" in
			( with-secret-1 )
				_common_arguments+=(
						--secret "${_secret_1}"
					)
			;;
			( with-secret-1d )
				_encrypt_arguments+=(
						--secret "${_secret_1}"
					)
				_decrypt_arguments+=(
						--secret "${_secret_1}"
						--secret "${_secret_1}"
					)
			;;
			( with-secret-2 )
				_encrypt_arguments+=(
						--secret "${_secret_1}"
						--secret "${_secret_2}"
					)
				_decrypt_arguments+=(
						--secret "${_secret_2}"
						--secret "${_secret_1}"
					)
			;;
			( with-secret-2d )
				_encrypt_arguments+=(
						--secret "${_secret_1}"
						--secret "${_secret_1}"
						--secret "${_secret_2}"
					)
				_decrypt_arguments+=(
						--secret "${_secret_2}"
						--secret "${_secret_1}"
						--secret "${_secret_1}"
					)
			;;
			( without-secret )
			;;
			( empty-secret )
				_encrypt_arguments+=(
						--secret ''
					)
				_decrypt_arguments+=(
					)
				_empty_is_missing=true
			;;
			( __* )
				continue
			;;
			( * )
				false
			;;
		esac
		
		case "${_case_ssh_wrap}" in
			( with-ssh-wrap-1 )
				_common_arguments+=(
						--ssh-wrap "${_ssh_wrap_1}"
					)
			;;
			( with-ssh-wrap-1d )
				_encrypt_arguments+=(
						--ssh-wrap "${_ssh_wrap_1}"
					)
				_decrypt_arguments+=(
						--ssh-wrap "${_ssh_wrap_1}"
						--ssh-wrap "${_ssh_wrap_1}"
					)
			;;
			( with-ssh-wrap-2 )
				_encrypt_arguments+=(
						--ssh-wrap "${_ssh_wrap_1}"
						--ssh-wrap "${_ssh_wrap_2}"
					)
				_decrypt_arguments+=(
						--ssh-wrap "${_ssh_wrap_2}"
						--ssh-wrap "${_ssh_wrap_1}"
					)
			;;
			( with-ssh-wrap-2d )
				_encrypt_arguments+=(
						--ssh-wrap "${_ssh_wrap_1}"
						--ssh-wrap "${_ssh_wrap_1}"
						--ssh-wrap "${_ssh_wrap_2}"
					)
				_decrypt_arguments+=(
						--ssh-wrap "${_ssh_wrap_2}"
						--ssh-wrap "${_ssh_wrap_1}"
						--ssh-wrap "${_ssh_wrap_1}"
					)
			;;
			( without-ssh-wrap )
			;;
			( empty-ssh-wrap )
				_encrypt_arguments+=(
						--ssh-wrap ''
					)
				_decrypt_arguments+=(
					)
				_empty_is_missing=true
			;;
			( __* )
				continue
			;;
			( * )
				false
			;;
		esac
		
		case "${_case_deterministic}" in
			( with-siv )
				_encrypt_arguments+=(
						--siv
					)
			;;
			( with-salt )
			;;
			( __* )
				continue
			;;
			( * )
				false
			;;
		esac
		
		if test "${#_encrypt_arguments[@]}" -eq 0 ; then
			printf -- '[ii]    -> empty encryption;  skipping!\n' >&2
			continue
		fi
		if test "${#_decrypt_arguments[@]}" -eq 0 ; then
			printf -- '[ii]    -> empty decryption;  skipping!\n' >&2
			continue
		fi
		
		_common_arguments+=(
				--empty-is-missing "${_empty_is_missing}"
			)
		
		_encrypt_command=(
				encrypt
					"${_encrypt_arguments[@]}"
					"${_common_arguments[@]}"
			)
		_decrypt_command=(
				decrypt
					"${_decrypt_arguments[@]}"
					"${_common_arguments[@]}"
			)
		
		printf -- '[xx]    >> %s\n' "${_encrypt_command[*]@Q}" >&2
		printf -- '[xx]    >> %s\n' "${_decrypt_command[*]@Q}" >&2
		
		TIMEFORMAT="[ii]    -> CPU (u/s/w):  %3lU %3lS %3lR;"
		
		time \
		cat \
			< "${_file}" \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" "${_encrypt_command[@]}" \
		| "${__OUTPUTS}/binaries/z-exchange--release--linux--native" "${_decrypt_command[@]}" \
		| md5sum -b -- /dev/fd/5 5<&0 \
		| md5sum -c --quiet 5< "${_file}" \
		#
		
		printf -- '\n' >&2
		
	done ; done ; done ; done ; done
!!








--<< tests / quick / exchange / files
	test "${#}" -eq 0
	
	find ./sources -type f | sort
!!








<< tests / quick / exchange / ssh / generate
	test "${#}" -eq 0
	
	_path="${__OUTPUTS}/ssh-keygen.${$}.${SRANDOM}"
	
	ssh-keygen \
			-q \
			-t ed25519 \
			-C 'z-exchange ssh wrap key for testing' \
			-N '' \
			-f "${_path}" \
	#
	
	printf -- '## key fingerprint\n'
	ssh-keygen \
			-l \
			-E SHA256 \
			-f "${_path}.pub" \
	#
	printf -- '\n'
	
	printf -- '## public key\n'
	cat -- "${_path}.pub"
	printf -- '\n'
	
	printf -- '## private key\n'
	cat -- "${_path}"
	printf -- '\n'
	
	rm -- "${_path}" "${_path}.pub"
!!


<< tests / quick / exchange / ssh / load / testing-1
	test "${#}" -eq 0
	
	printf -- '[ii]  loading `%s`...\n' \
			'ztxws1qqqqqzmnwd5z6etyxg6n2vfeqqqqqg9e9nt4vgd7c6s4tgmecj86kwpfpj7nsnnujzq6f4243jl2vecyrsqspf9hel' \
			'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILks11YhvsahVaN5xI+rOCkMvThOfJCBpNVVjL6mZwQc' \
			'SHA256:ro0s5DyFq2CE4LuWiWLL9TAfT7Uy+kM2+VLjteCHBIc' \
		>&2 \
	#
	
	ssh-add -- /dev/stdin << 'EOS'
	-----BEGIN OPENSSH PRIVATE KEY-----
	b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
	QyNTUxOQAAACC5LNdWIb7GoVWjecSPqzgpDL04TnyQgaTVVYy+pmcEHAAAALCIOkpDiDpK
	QwAAAAtzc2gtZWQyNTUxOQAAACC5LNdWIb7GoVWjecSPqzgpDL04TnyQgaTVVYy+pmcEHA
	AAAEBt/+OBtWrN7kZOK/AidxjmK+6hgt80u9RMII7Qf6ADY7ks11YhvsahVaN5xI+rOCkM
	vThOfJCBpNVVjL6mZwQcAAAAKnotdG9rZW5zIGV4Y2hhbmdlIHNzaCB3cmFwIGtleSBmb3
	IgdGVzdGluZwECAw==
	-----END OPENSSH PRIVATE KEY-----
	EOS
!!


<< tests / quick / exchange / ssh / load / testing-2
	test "${#}" -eq 0
	
	printf -- '[ii]  loading `%s`...\n' \
			'ztxws1qqqqqzmnwd5z6etyxg6n2vfeqqqqqgyg7zfdlhxsaymch3pu5c74xz82y5pt67grpy6ej8tcatltw4ar0gqss7rhum' \
			'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIjwkt/c0Ok3i8Q8pj1TCOolAr15Awk1mR146v63V6N6' \
			'SHA256:WRjxd4AByQpJgIqT24dkBU0gUQzmX+3iHnMwoiE9PRE' \
		>&2 \
	#
	
	ssh-add -- /dev/stdin << 'EOS'
	-----BEGIN OPENSSH PRIVATE KEY-----
	b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
	QyNTUxOQAAACCI8JLf3NDpN4vEPKY9UwjqJQK9eQMJNZkdeOr+t1ejegAAALD1rAbQ9awG
	0AAAAAtzc2gtZWQyNTUxOQAAACCI8JLf3NDpN4vEPKY9UwjqJQK9eQMJNZkdeOr+t1ejeg
	AAAEDakYilS6TJ8D7ocHJjLj82IImDIr145vjxKwzp0e04qIjwkt/c0Ok3i8Q8pj1TCOol
	Ar15Awk1mR146v63V6N6AAAAKnotdG9rZW5zIGV4Y2hhbmdlIHNzaCB3cmFwIGtleSBmb3
	IgdGVzdGluZwECAw==
	-----END OPENSSH PRIVATE KEY-----
	EOS
!!








&&== env-fallback __ZTOKENS_EXCHANGE_SENDER_PRIVATE ztxsk1szluhkftlf5zee8wfd6v43el6qa9c7f74sn3xaxjrxzh84q7436qhmh920
&&== env-fallback __ZTOKENS_EXCHANGE_SENDER_PUBLIC ztxsp1m6f9fwz0ukd7agd3udrlqsu8j0ltc8evfpzw7n040yjatkr4u4nq38he88

&&== env-fallback __ZTOKENS_EXCHANGE_RECIPIENT_PRIVATE ztxrk1rp0qkrrrht77nh42pkzcf70uy3yrs5uxpq6uvql55h3jsgsxm9fqn6lxmk
&&== env-fallback __ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC ztxrp17qqdhxkytsfp0ugz0h3zxuy4l2hhszxpaqt9cmqndjg8qllxfamszurtah


:: tests / quick / exchange / set / keys / both :: export -- __ZTOKENS_EXCHANGE_SENDER_PRIVATE=ztxsk1szluhkftlf5zee8wfd6v43el6qa9c7f74sn3xaxjrxzh84q7436qhmh920 __ZTOKENS_EXCHANGE_SENDER_PUBLIC=ztxsp1m6f9fwz0ukd7agd3udrlqsu8j0ltc8evfpzw7n040yjatkr4u4nq38he88 __ZTOKENS_EXCHANGE_RECIPIENT_PRIVATE=ztxrk1rp0qkrrrht77nh42pkzcf70uy3yrs5uxpq6uvql55h3jsgsxm9fqn6lxmk __ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC=ztxrp17qqdhxkytsfp0ugz0h3zxuy4l2hhszxpaqt9cmqndjg8qllxfamszurtah
:: tests / quick / exchange / set / keys / self :: export -- __ZTOKENS_EXCHANGE_SENDER_PRIVATE=ztxsk17zpadjtunyk3tst6p08e8qk9hpaxvrat595vy3kgtu0t8d8ehazqg5na4m __ZTOKENS_EXCHANGE_SENDER_PUBLIC= __ZTOKENS_EXCHANGE_RECIPIENT_PRIVATE=ztxrk17zpadjtunyk3tst6p08e8qk9hpaxvrat595vy3kgtu0t8d8ehazqfgdyps __ZTOKENS_EXCHANGE_RECIPIENT_PUBLIC=

:: tests / quick / exchange / set / secret / empty :: export -- __ZTOKENS_EXCHANGE_SECRET=''
:: tests / quick / exchange / set / secret / testing-1 :: export -- __ZTOKENS_EXCHANGE_SECRET='ztxcs1qvjhy8ftc7fjajtky3mcrgxdlacer2m6sj8hyxcaa2segdcnhjnqj7ylhm'
:: tests / quick / exchange / set / secret / testing-2 :: export -- __ZTOKENS_EXCHANGE_SECRET='ztxcs1zw32errd0vu44rvt2h6vnmfecjtp20aacyzpxcyg9dq3szerw0sswvu32a'

:: tests / quick / exchange / set / pin / empty :: export -- __ZTOKENS_EXCHANGE_PIN=''
:: tests / quick / exchange / set / pin / random :: export -- __ZTOKENS_EXCHANGE_PIN="${SRANDOM}"

:: tests / quick / exchange / set / ssh-wrap / empty :: export -- __ZTOKENS_EXCHANGE_SSH_WRAP=''
:: tests / quick / exchange / set / ssh-wrap / testing-1 :: export -- __ZTOKENS_EXCHANGE_SSH_WRAP=ztxws1qqqqqzmnwd5z6etyxg6n2vfeqqqqqg9e9nt4vgd7c6s4tgmecj86kwpfpj7nsnnujzq6f4243jl2vecyrsqspf9hel
:: tests / quick / exchange / set / ssh-wrap / testing-2 :: export -- __ZTOKENS_EXCHANGE_SSH_WRAP=ztxws1qqqqqzmnwd5z6etyxg6n2vfeqqqqqgyg7zfdlhxsaymch3pu5c74xz82y5pt67grpy6ej8tcatltw4ar0gqss7rhum


